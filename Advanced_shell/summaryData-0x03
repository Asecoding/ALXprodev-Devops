#!/bin/bash

# Output CSV file
CSV_FILE="pokemon_report.csv"

# Header for CSV
echo "Name,Height(m),Weight(kg)" > "$CSV_FILE"

# Loop through all JSON files
for file in *.json; do
    # Extract data using jq
    name=$(jq -r '.name' "$file")
    height_dm=$(jq -r '.height' "$file")   # decimeters
    weight_hg=$(jq -r '.weight' "$file")   # hectograms

    # Convert to meters and kilograms
    height_m=$(awk "BEGIN {printf \"%.1f\", $height_dm / 10}")
    weight_kg=$(awk "BEGIN {printf \"%.1f\", $weight_hg / 10}")

    # Append to CSV
    echo "$name,$height_m,$weight_kg" >> "$CSV_FILE"
done

# Display the CSV
echo "ðŸ“„ Generated CSV:"
cat "$CSV_FILE"

# Calculate averages using awk
echo ""
echo "ðŸ“ˆ Averages:"
awk -F',' 'NR>1 {height+=$2; weight+=$3} END {printf "Average Height: %.2fm\nAverage Weight: %.2fkg\n", height/(NR-1), weight/(NR-1)}' "$CSV_FILE"

